<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>NamedThreadFactory.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Core XMPP Server</a> &gt; <a href="index.source.html" class="el_package">org.jivesoftware.util</a> &gt; <span class="el_source">NamedThreadFactory.java</span></div><h1>NamedThreadFactory.java</h1><pre class="source lang-java linenums">package org.jivesoftware.util;

import java.util.concurrent.ThreadFactory;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * A thread factory that allows threads to be named.
 *
 * An instance will either create new Threads, or use use a delegate Thread Factory.
 * When a new thread is generated, the name of the generated thread is replaced by concatenation of the provided thread
 * name prefix (which is an other argument of the constructor) and a sequence number. Sequence numbers are guaranteed to
 * be unique for threads generated by the same instance of this class.
 *
 * Optionally, this implementation allows the priority, isDaemon and threadGroup and stackSize value of the generated
 * threads to be set/overridden. Note that the threadGroup and stackSize value cannot be overridden when a delegate
 * thread factory is used.
 *
 * This implementation is thread safe when the provided delegate is thread safe.
 *
 * @author Guus der Kinderen, guus.der.kinderen@gmail.com
 */
public class NamedThreadFactory implements ThreadFactory
{
<span class="pc" id="L24">    private final AtomicInteger threadNumber = new AtomicInteger(1);</span>

    private final String threadNamePrefix;
    private final ThreadFactory delegate;
    private final Boolean daemon;
    private final Integer priority;
    private final Long stackSize;
    private final ThreadGroup threadGroup;

    /**
     * Constructs an instance that delegates thread creation to the thread factory passed as an argument. When the
     * delegate argument is null, the instance will instantiate threads itself (similar to the functionality of the
     * other constructor of this class).
     *
     * When null is provided for the optional arguments of this method, the values as defined by the delegate factory
     * are used.
     *
     * @param threadNamePrefix The prefix of the name for new threads (cannot be null or an empty string).
     * @param delegate The factory to which this implementation delegates to (null when no override is desired).
     * @param daemon override for the isDaemon value for new threads (null when no override is desired).
     * @param priority override for the priority value for new threads (null when no override is desired).
     */
    public NamedThreadFactory( String threadNamePrefix, ThreadFactory delegate, Boolean daemon, Integer priority )
<span class="nc" id="L47">    {</span>
<span class="nc bnc" id="L48" title="All 4 branches missed.">        if ( threadNamePrefix == null || threadNamePrefix.isEmpty() )</span>
        {
<span class="nc" id="L50">            throw new IllegalArgumentException( &quot;Argument 'threadNamePrefix' cannot be null or an empty string.&quot; );</span>
        }
<span class="nc" id="L52">        this.threadNamePrefix = threadNamePrefix;</span>
<span class="nc" id="L53">        this.delegate = delegate;</span>
<span class="nc" id="L54">        this.daemon = daemon;</span>
<span class="nc" id="L55">        this.priority = priority;</span>
<span class="nc" id="L56">        this.threadGroup = null;</span>
<span class="nc" id="L57">        this.stackSize = null;</span>
<span class="nc" id="L58">    }</span>

    /**
     * Constructs a thread factory that will create new Thread instances (as opposed to using a delegate thread
     * factory).
     *
     * When null is provided for the optional arguments of this method, default values as provided by the Thread class
     * implementation will be used.
     *
     * @param threadNamePrefix The prefix of the name for new threads (cannot be null or an empty string).
     * @param daemon the isDaemon value for new threads (null to use default value).
     * @param priority override for the priority value for new threads (null to use default value).
     * @param threadGroup override for the thread group (null to use default value).
     * @param stackSize override for the stackSize value for new threads (null to use default value).
     */
    public NamedThreadFactory( String threadNamePrefix, Boolean daemon, Integer priority, ThreadGroup threadGroup, Long stackSize )
<span class="fc" id="L74">    {</span>
<span class="pc bpc" id="L75" title="2 of 4 branches missed.">        if ( threadNamePrefix == null || threadNamePrefix.isEmpty() )</span>
        {
<span class="nc" id="L77">            throw new IllegalArgumentException( &quot;Argument 'threadNamePrefix' cannot be null or an empty string.&quot; );</span>
        }

<span class="fc" id="L80">        this.delegate = null;</span>
<span class="fc" id="L81">        this.threadNamePrefix = threadNamePrefix;</span>
<span class="fc" id="L82">        this.daemon = daemon;</span>
<span class="fc" id="L83">        this.priority = priority;</span>
<span class="fc" id="L84">        this.threadGroup = threadGroup;</span>
<span class="fc" id="L85">        this.stackSize = stackSize;</span>
<span class="fc" id="L86">    }</span>

    @Override
    public Thread newThread( Runnable runnable )
    {
<span class="nc" id="L91">        final String name = threadNamePrefix + threadNumber.incrementAndGet();</span>

        final Thread thread;
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if ( delegate != null )</span>
        {
<span class="nc" id="L96">            thread = delegate.newThread( runnable );</span>
<span class="nc" id="L97">            thread.setName( name );</span>
        }
        else
        {
<span class="nc bnc" id="L101" title="All 2 branches missed.">            if ( stackSize != null )</span>
            {
<span class="nc" id="L103">                thread = new Thread( threadGroup, runnable, name, stackSize );</span>
            }
            else
            {
<span class="nc" id="L107">                thread = new Thread( threadGroup, runnable, name );</span>
            }
        }

<span class="nc bnc" id="L111" title="All 4 branches missed.">        if ( daemon != null &amp;&amp; thread.isDaemon() != daemon )</span>
        {
<span class="nc" id="L113">            thread.setDaemon( daemon );</span>
        }

<span class="nc bnc" id="L116" title="All 4 branches missed.">        if ( priority != null &amp;&amp; thread.getPriority() != priority )</span>
        {
<span class="nc" id="L118">            thread.setPriority( priority );</span>
        }

<span class="nc" id="L121">        return thread;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>